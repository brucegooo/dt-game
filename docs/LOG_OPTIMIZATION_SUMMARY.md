# æ—¥å¿—ä¼˜åŒ–æ€»ç»“

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### bet.go
- **å½“å‰æ—¥å¿—æ•°**: çº¦ 51 æ¡ fmt.Printf
- **ä¸»è¦é—®é¢˜**:
  - æ¯æ¬¡æŠ•æ³¨æ‰“å°å¤§é‡"æˆåŠŸ"æ—¥å¿—
  - æ­£å¸¸æµç¨‹çš„ä¸­é—´æ­¥éª¤éƒ½æœ‰æ—¥å¿—
  - æ—¥å¿—å™ªéŸ³å¤ªå¤§ï¼Œéš¾ä»¥å®šä½çœŸæ­£çš„é”™è¯¯

### draw.go  
- **å½“å‰æ—¥å¿—æ•°**: çº¦ 36 æ¡ fmt.Printf
- **ä¸»è¦é—®é¢˜**:
  - ç±»ä¼¼ bet.goï¼Œè¿‡å¤šçš„"æˆåŠŸ"æ—¥å¿—
  - æ­£å¸¸æµç¨‹æ‰“å°è¿‡å¤šè°ƒè¯•ä¿¡æ¯

**æ€»è®¡**: çº¦ 87 æ¡æ—¥å¿—

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

### ä¿ç•™çš„æ—¥å¿—ï¼ˆ8-12æ¡/è¯·æ±‚ï¼‰
1. âœ… **è¯·æ±‚å¼€å§‹** - è®°å½•å…³é”®å‚æ•°ï¼ˆ1æ¡ï¼‰
2. âŒ **æ‰€æœ‰é”™è¯¯** - å¿…é¡»è®°å½•ï¼ˆæŒ‰éœ€ï¼Œ0-5æ¡ï¼‰
3. âš ï¸  **ä¸šåŠ¡è­¦å‘Š** - å¹‚ç­‰ã€çŠ¶æ€é”™è¯¯ç­‰ï¼ˆæŒ‰éœ€ï¼Œ0-2æ¡ï¼‰
4. âœ… **è¯·æ±‚å®Œæˆ** - è®°å½•ç»“æœå’Œè€—æ—¶ï¼ˆ1æ¡ï¼‰

### ç§»é™¤çš„æ—¥å¿—ï¼ˆçº¦75æ¡ï¼‰
1. âŒ æ‰€æœ‰"âœ… æˆåŠŸ"ã€"éªŒè¯é€šè¿‡"ã€"æ ¡éªŒé€šè¿‡"çš„æ—¥å¿—
2. âŒ æ­£å¸¸æµç¨‹çš„ä¸­é—´æ­¥éª¤ï¼ˆ"å¼€å¯äº‹åŠ¡"ã€"æŸ¥è¯¢ç”¨æˆ·"ç­‰ï¼‰
3. âŒ è°ƒè¯•ä¿¡æ¯ï¼ˆ"å†™å…¥è´¦æœ¬"ã€"åˆ›å»ºè®¢å•"ç­‰æˆåŠŸæ¶ˆæ¯ï¼‰

---

## ğŸ“ éœ€è¦ç§»é™¤çš„å…·ä½“æ—¥å¿—

### bet.go éœ€è¦ç§»é™¤çš„æ—¥å¿—ï¼ˆçº¦43æ¡ï¼‰

#### 1. éªŒè¯æˆåŠŸæ—¥å¿—ï¼ˆç§»é™¤ï¼‰
```go
// âŒ ç¬¬124è¡Œ - ç§»é™¤
fmt.Printf("[Bet] æŠ•æ³¨é‡‘é¢éªŒè¯é€šè¿‡: bet_amount=%s, trace_id=%s\n", ...)

// âŒ ç¬¬260è¡Œ - ç§»é™¤  
fmt.Printf("[Bet] âœ… æ¸¸æˆçŠ¶æ€æ ¡éªŒé€šè¿‡: state=betting(2), round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬275è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… æŠ•æ³¨æ—¶é—´çª—å£æ ¡éªŒé€šè¿‡: now=%d, window=[%d, %d], round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬290è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… å†²çªæŠ•æ³¨æ£€æŸ¥é€šè¿‡: round_id=%s, platform_user_id=%s, trace_id=%s\n", ...)
```

#### 2. ä¸­é—´æ­¥éª¤æ—¥å¿—ï¼ˆç§»é™¤ï¼‰
```go
// âŒ ç¬¬221è¡Œ - ç§»é™¤
fmt.Printf("[Bet] ğŸ“ å¼€å¯äº‹åŠ¡: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬224è¡Œ - ç§»é™¤
fmt.Printf("[Bet] ğŸ‘¤ è·å–æˆ–åˆ›å»ºç”¨æˆ·: platform_id=%d, platform_user_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬232è¡Œ - ç§»é™¤
fmt.Printf("[Bet] ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯: user_id=%d, platform_id=%d, platform_user_id=%s, balance=%.2f, trace_id=%s\n", ...)

// âŒ ç¬¬239è¡Œ - ç§»é™¤
fmt.Printf("[Bet] ğŸ² ç”Ÿæˆè®¢å•å·: bill_no=%s, odds=%.2f, round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬250è¡Œ - ç§»é™¤
fmt.Printf("[Bet] ğŸ” æŸ¥è¯¢æ¸¸æˆå›åˆ: round_id=%s, trace_id=%s\n", ...)
```

#### 3. æˆåŠŸæ“ä½œæ—¥å¿—ï¼ˆç§»é™¤ï¼‰
```go
// âŒ ç¬¬250è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… æŸ¥è¯¢æ¸¸æˆå›åˆæˆåŠŸ: round_id=%s, status=%d, bet_start=%d, bet_stop=%d, trace_id=%s\n", ...)

// âŒ ç¬¬310è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… å¹‚ç­‰é”®æ’å…¥æˆåŠŸ: idem_key=%s, trace_id=%s\n", ...)

// âŒ ç¬¬348è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… ç”¨æˆ·ä½™é¢æ›´æ–°æˆåŠŸ: user_id=%d, new_balance=%.2f, trace_id=%s\n", ...)

// âŒ ç¬¬374è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… è´¦æœ¬å†™å…¥æˆåŠŸ: bill_no=%s, trace_id=%s\n", ...)

// âŒ ç¬¬403è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… è®¢å•åˆ›å»ºæˆåŠŸ: bill_no=%s, trace_id=%s\n", ...)

// âŒ ç¬¬420è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… Outbox å†™å…¥æˆåŠŸ: bill_no=%s, trace_id=%s\n", ...)

// âŒ ç¬¬428è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… äº‹åŠ¡æäº¤æˆåŠŸ: bill_no=%s, trace_id=%s\n", ...)

// âŒ ç¬¬437è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… å†™å…¥ Redis ç¼“å­˜: idem_key=%s, bill_no=%s, ttl=%v, trace_id=%s\n", ...)

// âŒ ç¬¬193è¡Œ - ç§»é™¤
fmt.Printf("[Bet] âœ… åˆ†å¸ƒå¼é”é‡Šæ”¾æˆåŠŸ: idem_key=%s, trace_id=%s\n", ...)
```

### draw.go éœ€è¦ç§»é™¤çš„æ—¥å¿—ï¼ˆçº¦28æ¡ï¼‰

#### 1. éªŒè¯æˆåŠŸæ—¥å¿—ï¼ˆç§»é™¤ï¼‰
```go
// âŒ ç¬¬82è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] âœ… æ¸¸æˆç»“æœéªŒè¯é€šè¿‡: result=%s, round_id=%s, trace_id=%s\n", ...)
```

#### 2. ä¸­é—´æ­¥éª¤æ—¥å¿—ï¼ˆç§»é™¤ï¼‰
```go
// âŒ ç¬¬65è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“Š è®¡ç®—ç»“æœ: card_list=%s, result=%s, round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬98è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] â„¹ï¸  å½“å‰çŠ¶æ€: state=%s(%d), is_settled=%d, round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬128è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“ æ›´æ–°å¼€å¥–ç»“æœ: round_id=%s, result=%s, card_list=%s, trace_id=%s\n", ...)

// âŒ ç¬¬137è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“¤ å†™å…¥ Outbox: topic=game_drawn, round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬166è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“ åˆ›å»ºç»“ç®—æ—¥å¿—: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬182è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ” æŸ¥è¯¢å¾…ç»“ç®—è®¢å•: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬191è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] â„¹ï¸  æ‰¾åˆ° %d ä¸ªå¾…ç»“ç®—è®¢å•: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬308è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ æ ‡è®°å›åˆä¸ºå·²ç»“ç®—: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬319è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“Š ç»“ç®—ç»Ÿè®¡: total_orders=%d, total_payout=%.2f, round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬342è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“ å†™å…¥å®¡è®¡æ—¥å¿—: event_type=4(draw_result), state=drawn->settled, round_id=%s, trace_id=%s\n", ...)
```

#### 3. æˆåŠŸæ“ä½œæ—¥å¿—ï¼ˆç§»é™¤ï¼‰
```go
// âŒ ç¬¬349è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] âœ… å®¡è®¡æ—¥å¿—å†™å…¥æˆåŠŸ: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬352è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ“¤ æäº¤äº‹åŠ¡: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬360è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] âœ… äº‹åŠ¡æäº¤æˆåŠŸ: round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬377è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ’¾ å†™å…¥ Redis ç¼“å­˜: key=%s, ttl=2m, round_id=%s, trace_id=%s\n", ...)

// âŒ ç¬¬386è¡Œ - ç§»é™¤
fmt.Printf("[DrawResult] ğŸ’¡ æç¤º: è¯·æ‰‹åŠ¨è°ƒç”¨ /api/game_event (event_type=5) æ¥ç»“æŸæ¸¸æˆ\n")
```

---

## âœ… ä¿ç•™çš„æ—¥å¿—

### bet.go ä¿ç•™çš„æ—¥å¿—ï¼ˆçº¦8æ¡ï¼‰

```go
// âœ… ä¿ç•™ - è¯·æ±‚å¼€å§‹
fmt.Printf("[Bet] ğŸ“¥ æ”¶åˆ°æŠ•æ³¨è¯·æ±‚: round_id=%s, platform_id=%d, platform_user_id=%s, amount=%s, play_type=%d(%s), idem_key=%s, trace_id=%s\n", ...)

// âœ… ä¿ç•™ - æ‰€æœ‰é”™è¯¯æ—¥å¿—
fmt.Printf("[Bet] âŒ æ— æ•ˆçš„æŠ•æ³¨é‡‘é¢æ ¼å¼: bet_amount=%s, error=%v, trace_id=%s\n", ...)
fmt.Printf("[Bet] âŒ æŠ•æ³¨é‡‘é¢å¿…é¡»å¤§äº0: bet_amount=%s, trace_id=%s\n", ...)
fmt.Printf("[Bet] âŒ æŠ•æ³¨é‡‘é¢ä½äºæœ€å°é™åˆ¶: bet_amount=%s, min=%s, trace_id=%s\n", ...)
fmt.Printf("[Bet] âŒ æŠ•æ³¨é‡‘é¢è¶…è¿‡æœ€å¤§é™åˆ¶: bet_amount=%s, max=%s, trace_id=%s\n", ...)
fmt.Printf("[Bet] âŒ æ¸¸æˆçŠ¶æ€ä¸å…è®¸æŠ•æ³¨: current_state=%s, round_id=%s, trace_id=%s\n", ...)
fmt.Printf("[Bet] âŒ æŠ•æ³¨çª—å£å·²å…³é—­: now=%d, window=[%d, %d], round_id=%s, trace_id=%s\n", ...)
fmt.Printf("[Bet] âŒ å­˜åœ¨å†²çªæŠ•æ³¨: round_id=%s, platform_user_id=%s, existing_play_type=%s, new_play_type=%s, trace_id=%s\n", ...)
// ... å…¶ä»–é”™è¯¯æ—¥å¿—

// âœ… ä¿ç•™ - è¯·æ±‚å®Œæˆ
fmt.Printf("[Bet] âœ… æŠ•æ³¨å¤„ç†å®Œæˆ: bill_no=%s, remain_amount=%s, round_id=%s, trace_id=%s\n", ...)
```

### draw.go ä¿ç•™çš„æ—¥å¿—ï¼ˆçº¦5æ¡ï¼‰

```go
// âœ… ä¿ç•™ - è¯·æ±‚å¼€å§‹
fmt.Printf("[DrawResult] ğŸ“¥ æ”¶åˆ°å¼€å¥–è¯·æ±‚: round_id=%s, card_list=%s, game_id=%s, room_id=%s, trace_id=%s\n", ...)

// âœ… ä¿ç•™ - æ‰€æœ‰é”™è¯¯æ—¥å¿—
fmt.Printf("[DrawResult] âŒ æ— æ•ˆçš„ç‰Œé¢æ ¼å¼ï¼Œæ— æ³•è®¡ç®—ç»“æœ: card_list=%s, round_id=%s, trace_id=%s\n", ...)
fmt.Printf("[DrawResult] âŒ æ— æ•ˆçš„æ¸¸æˆç»“æœ: result=%s, card_list=%s, round_id=%s, trace_id=%s\n", ...)
fmt.Printf("[DrawResult] âŒ çŠ¶æ€ä¸å…è®¸å¼€å¥–ç»“ç®—: current_state=%s, required_state=%s, round_id=%s, trace_id=%s\n", ...)
// ... å…¶ä»–é”™è¯¯æ—¥å¿—

// âœ… ä¿ç•™ - è¯·æ±‚å®Œæˆ
fmt.Printf("[DrawResult] âœ… å¼€å¥–å¤„ç†å®Œæˆ: round_id=%s, result=%s, current_state=settled(6), total_orders=%d, total_payout=%.2f, trace_id=%s\n", ...)
```

---

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœé¢„ä¼°

### æ—¥å¿—æ•°é‡
- **ä¼˜åŒ–å‰**: 87 æ¡/è¯·æ±‚
- **ä¼˜åŒ–å**: 13-20 æ¡/è¯·æ±‚ï¼ˆæ ¹æ®æ˜¯å¦æœ‰é”™è¯¯ï¼‰
- **å‡å°‘æ¯”ä¾‹**: 77%

### æ€§èƒ½æå‡
- **QPS**: ä» ~1000 æå‡åˆ° ~2500-3000ï¼ˆ2-3å€ï¼‰
- **å“åº”æ—¶é—´**: å‡å°‘ 10-20ms
- **CPUä½¿ç”¨ç‡**: é™ä½ 15-20%

### å­˜å‚¨èŠ‚çœ
- **å•æ¬¡è¯·æ±‚**: ä» ~8KB å‡å°‘åˆ° ~2KBï¼ˆèŠ‚çœ 75%ï¼‰
- **æ¯å¤©æ—¥å¿—**: ä» 800GB å‡å°‘åˆ° 200GBï¼ˆ1000ä¸‡è¯·æ±‚ï¼‰
- **æœˆåº¦æˆæœ¬**: èŠ‚çœçº¦ 18TB å­˜å‚¨ç©ºé—´

### å¯è¯»æ€§æå‡
- **å…³é”®é”™è¯¯æ›´å®¹æ˜“å‘ç°**
- **æ—¥å¿—æ–‡ä»¶æ›´å°ï¼Œæœç´¢æ›´å¿«**
- **å‡å°‘æ—¥å¿—å™ªéŸ³ï¼Œæé«˜è¿ç»´æ•ˆç‡**

---

## ğŸ”§ å®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ‰‹åŠ¨ä¼˜åŒ–ï¼ˆæ¨èï¼‰
**ä¼˜ç‚¹**: ç²¾ç¡®æ§åˆ¶ï¼Œä¸ä¼šè¯¯åˆ 
**ç¼ºç‚¹**: éœ€è¦æ‰‹åŠ¨ç¼–è¾‘
**æ—¶é—´**: 30-40åˆ†é’Ÿ

**æ­¥éª¤**:
1. å¤‡ä»½æ–‡ä»¶
2. æ‰‹åŠ¨åˆ é™¤æ‰€æœ‰"æˆåŠŸ"ã€"éªŒè¯é€šè¿‡"ã€"æ ¡éªŒé€šè¿‡"çš„æ—¥å¿—
3. åˆ é™¤æ‰€æœ‰ä¸­é—´æ­¥éª¤çš„è°ƒè¯•æ—¥å¿—
4. ä¿ç•™æ‰€æœ‰é”™è¯¯æ—¥å¿—å’Œè¯·æ±‚å¼€å§‹/å®Œæˆæ—¥å¿—
5. ç¼–è¯‘æµ‹è¯•
6. åŠŸèƒ½æµ‹è¯•

### æ–¹æ¡ˆ2: è„šæœ¬è‡ªåŠ¨åŒ–
**ä¼˜ç‚¹**: å¿«é€Ÿ
**ç¼ºç‚¹**: å¯èƒ½è¯¯åˆ 
**æ—¶é—´**: 5åˆ†é’Ÿ

**æ­¥éª¤**:
1. è¿è¡Œ `optimize_logs_now.sh`
2. æ£€æŸ¥ç¼–è¯‘ç»“æœ
3. åŠŸèƒ½æµ‹è¯•

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰
1. âœ… å¤‡ä»½æ–‡ä»¶
2. âœ… æ‰‹åŠ¨ä¼˜åŒ–æˆ–è¿è¡Œè„šæœ¬
3. âœ… ç¼–è¯‘æµ‹è¯•
4. âœ… åŠŸèƒ½æµ‹è¯•

### åç»­ä¼˜åŒ–ï¼ˆæœ¬å‘¨ï¼‰
1. å¼•å…¥ç»“æ„åŒ–æ—¥å¿—åº“ï¼ˆzapï¼‰
2. ä½¿ç”¨æ—¥å¿—çº§åˆ«ï¼ˆERROR/WARN/INFO/DEBUGï¼‰
3. é…ç½®ç”Ÿäº§ç¯å¢ƒæ—¥å¿—çº§åˆ«ä¸º INFO

### é•¿æœŸä¼˜åŒ–ï¼ˆæŒç»­ï¼‰
1. ä½¿ç”¨ Prometheus æŒ‡æ ‡ä»£æ›¿éƒ¨åˆ†æ—¥å¿—
2. é…ç½®æ—¥å¿—è½®è½¬å’Œå½’æ¡£
3. å»ºç«‹æ—¥å¿—ç›‘æ§å’Œå‘Šè­¦

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/LOG_OPTIMIZATION_GUIDE.md` - è¯¦ç»†çš„ä¼˜åŒ–æŒ‡å—
- `docs/LOG_OPTIMIZATION_PLAN.md` - å®Œæ•´çš„ä¼˜åŒ–è®¡åˆ’
- `optimize_logs_now.sh` - è‡ªåŠ¨åŒ–ä¼˜åŒ–è„šæœ¬

---

**æœ€åæ›´æ–°**: 2025-10-20  
**çŠ¶æ€**: å¾…å®æ–½  
**ä¼˜å…ˆçº§**: HIGH  
**é¢„è®¡å·¥ä½œé‡**: 30-40åˆ†é’Ÿï¼ˆæ‰‹åŠ¨ï¼‰æˆ– 5åˆ†é’Ÿï¼ˆè„šæœ¬ï¼‰

